



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Centrifugo Documentation">
      
      
        <link rel="canonical" href="https://github.com/centrifugal/centrifugo/server/engines/">
      
      
        <meta name="author" content="Centrifugal">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Engines - Centrifugo Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../theme/styles/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="cyan">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#engines" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://github.com/centrifugal/centrifugo" title="Centrifugo Documentation" class="md-header-nav__button md-logo">
          
            <img src="../../images/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Centrifugo Documentation
            </span>
            <span class="md-header-nav__topic">
              Engines
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/centrifugal/centrifugo/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    centrifugal/centrifugo
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://github.com/centrifugal/centrifugo" title="Centrifugo Documentation" class="md-nav__button md-logo">
      
        <img src="../../images/logo.png" width="48" height="48">
      
    </a>
    Centrifugo Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/centrifugal/centrifugo/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    centrifugal/centrifugo
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../guide/" title="Integration Guide" class="md-nav__link">
      Integration Guide
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../channels/" title="Channels" class="md-nav__link">
      Channels
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../authentication/" title="Authentication" class="md-nav__link">
      Authentication
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Engines
      </label>
    
    <a href="./" title="Engines" class="md-nav__link md-nav__link--active">
      Engines
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#memory-engine" title="Memory engine" class="md-nav__link">
    Memory engine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redis-engine" title="Redis engine" class="md-nav__link">
    Redis engine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scaling-with-redis-tutorial" title="Scaling with Redis tutorial" class="md-nav__link">
    Scaling with Redis tutorial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redis-sharding" title="Redis sharding" class="md-nav__link">
    Redis sharding
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keydb-engine" title="KeyDB engine" class="md-nav__link">
    KeyDB engine
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../admin/" title="Admin web interface" class="md-nav__link">
      Admin web interface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../http_api/" title="Server HTTP API" class="md-nav__link">
      Server HTTP API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../grpc_api/" title="Server GRPC API" class="md-nav__link">
      Server GRPC API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../recover/" title="Message recovery" class="md-nav__link">
      Message recovery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../signals/" title="Signal handling" class="md-nav__link">
      Signal handling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../connection_expiration/" title="Connection expiration" class="md-nav__link">
      Connection expiration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../private_channels/" title="Private channels" class="md-nav__link">
      Private channels
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../proxy/" title="Proxy to backend" class="md-nav__link">
      Proxy to backend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../protobuf/" title="Protobuf protocol" class="md-nav__link">
      Protobuf protocol
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../protocol/" title="Client protocol" class="md-nav__link">
      Client protocol
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Transports
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Transports
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../transports/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../transports/websocket/" title="Websocket" class="md-nav__link">
      Websocket
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../transports/sockjs/" title="SockJS" class="md-nav__link">
      SockJS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Libraries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Libraries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../libraries/client/" title="Client libraries" class="md-nav__link">
      Client libraries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../libraries/api/" title="API libraries" class="md-nav__link">
      API libraries
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Deploy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Deploy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/packages/" title="RPM and DEB packages" class="md-nav__link">
      RPM and DEB packages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/docker/" title="Docker image" class="md-nav__link">
      Docker image
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/nginx/" title="Nginx configuration" class="md-nav__link">
      Nginx configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/tls/" title="TLS" class="md-nav__link">
      TLS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/redis/" title="Redis HA" class="md-nav__link">
      Redis HA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/tuning/" title="OS tuning" class="md-nav__link">
      OS tuning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Misc
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Misc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/insecure_modes/" title="Insecure modes" class="md-nav__link">
      Insecure modes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/migrate/" title="Migrate from Centrifugo v1" class="md-nav__link">
      Migrate from Centrifugo v1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/benchmark/" title="Benchmarking server" class="md-nav__link">
      Benchmarking server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#memory-engine" title="Memory engine" class="md-nav__link">
    Memory engine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redis-engine" title="Redis engine" class="md-nav__link">
    Redis engine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scaling-with-redis-tutorial" title="Scaling with Redis tutorial" class="md-nav__link">
    Scaling with Redis tutorial
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redis-sharding" title="Redis sharding" class="md-nav__link">
    Redis sharding
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keydb-engine" title="KeyDB engine" class="md-nav__link">
    KeyDB engine
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/centrifugal/documentation/edit/master/docs/server/engines.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="engines">Engines<a class="headerlink" href="#engines" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="#memory-engine">Memory engine</a></li>
<li><a href="#redis-engine">Redis engine</a></li>
</ul>
<p>Engine in Centrifugo is responsible for publishing messages between nodes, handle PUB/SUB broker subscriptions, save/retrieve presence and history data.</p>
<p>By default Centrifugo uses Memory engine. There is also Redis engine available.</p>
<p>The difference between them - with Memory engine you can start only one node of Centrifugo, while Redis engine allows to run several nodes on different machines and they will be connected via Redis, will know about each other due to Redis and will also keep history and presence data in Redis instead of Centrifugo node process memory so this data can be accessed from each node.</p>
<p>To set engine you can use <code>engine</code> configuration option. Available values are <code>memory</code> and <code>redis</code>. Default value is <code>memory</code>.</p>
<p>For example to work with Redis engine:</p>
<div class="codehilite"><pre><span></span>centrifugo --config=config.json --engine=redis
</pre></div>


<p>Or just set <code>engine</code> in config:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="err">...</span>
    <span class="nt">&quot;engine&quot;</span><span class="p">:</span> <span class="s2">&quot;redis&quot;</span>
<span class="p">}</span>
</pre></div>


<h3 id="memory-engine">Memory engine<a class="headerlink" href="#memory-engine" title="Permanent link">&para;</a></h3>
<p>Supports only one node. Nice choice to start with. Supports all features keeping everything in Centrifugo node process memory. You don&rsquo;t need to install Redis when using this engine.</p>
<p>Advantages:</p>
<ul>
<li>fast</li>
<li>does not require separate Redis setup</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>does not allow to scale nodes (actually you still can scale Centrifugo with Memory engine but you have to publish data into each Centrifugo node and you won&rsquo;t have consistent state of presence)</li>
</ul>
<h3 id="redis-engine">Redis engine<a class="headerlink" href="#redis-engine" title="Permanent link">&para;</a></h3>
<p>Allows scaling Centrifugo nodes to different machines. Nodes will use Redis as message broker. Redis engine keeps presence and history data in Redis, uses Redis PUB/SUB for internal nodes communication.</p>
<p><strong>Minimal Redis version is 3.2.0</strong></p>
<p>Several configuration options related to Redis engine:</p>
<ul>
<li><code>redis_host</code> (string, default <code>"127.0.0.1"</code>) - Redis server host</li>
<li><code>redis_port</code> (int, default <code>6379</code>) - Redis server port</li>
<li><code>redis_url</code> (string, default <code>""</code>) - optional Redis connection URL</li>
<li><code>redis_password</code> (string, default <code>""</code>) - Redis password</li>
<li><code>redis_db</code> (int, default <code>0</code>) - number of Redis db to use</li>
<li><code>redis_tls</code> (boolean, default <code>false</code>) - enable Redis TLS connection (new in v2.0.2)</li>
<li><code>redis_tls_skip_verify</code> (boolean, default <code>false</code>) - disable Redis TLS host verification (new in v2.0.2)</li>
<li><code>redis_sentinels</code> (string, default <code>""</code>) - comma separated list of Sentinels for HA</li>
<li><code>redis_master_name</code> (string, default <code>""</code>) - name of Redis master Sentinel monitors</li>
<li><code>redis_prefix</code> (string, default <code>"centrifugo"</code>) – custom prefix to use for channels and keys in Redis</li>
<li><code>redis_sequence_ttl</code> (int, default <code>0</code>) - sets a time in seconds of sequence data expiration in Redis Engine. Sequence meta key in Redis is a HASH that contains current sequence number in channel and epoch value. By default sequence data for channels does not expire. Though in some cases – when channels created for а short time and then not used anymore – created sequence meta data can stay in memory while not actually useful. For example you can have a personal user channel but after using your app for a while user left it forever. In long-term perspective this can be an unwanted memory leak. Setting a reasonable value to this option (usually much bigger than history retention period) can help. In this case unused channel sequence data will eventually expire. Available since v2.3.0</li>
</ul>
<p>All of these options can be set over configuration file. Some of them can be set over command-line arguments (see <code>centrifugo -h</code> output).</p>
<p>Let&rsquo;s describe a bit more <code>redis_url</code> option. <code>redis_url</code> allows to set Redis connection parameters in a form of URL in format <code>redis://:password@hostname:port/db_number</code>. When <code>redis_url</code> set Centrifugo will use URL instead of values provided in <code>redis_host</code>, <code>redis_port</code>, <code>redis_password</code>, <code>redis_db</code> options.</p>
<h3 id="scaling-with-redis-tutorial">Scaling with Redis tutorial<a class="headerlink" href="#scaling-with-redis-tutorial" title="Permanent link">&para;</a></h3>
<p>Let&rsquo;s see how to start several Centrifugo nodes using Redis engine. We will start 3 Centrifugo nodes and all those nodes will be connected via Redis.</p>
<p>First, you should have Redis running. As soon as it&rsquo;s running - we can launch 3 Centrifugo instances. Open your terminal and start first one:</p>
<div class="codehilite"><pre><span></span>centrifugo --config=config.json --port=8000 --engine=redis --redis_host=127.0.0.1 --redis_port=6379
</pre></div>


<p>If your Redis on the same machine and runs on its default port you can omit <code>redis_host</code> and <code>redis_port</code> options in command above.</p>
<p>Then open another terminal and start another Centrifugo instance:</p>
<div class="codehilite"><pre><span></span>centrifugo --config=config.json --port=8001 --engine=redis --redis_host=127.0.0.1 --redis_port=6379
</pre></div>


<p>Note that we use another port number (<code>8001</code>) as port 8000 already busy by our first Centrifugo instance. If you are starting Centrifugo instances on different machines then you most probably can use
the same port number (<code>8000</code> or whatever you want) for all instances.</p>
<p>And finally let&rsquo;s start third instance:</p>
<div class="codehilite"><pre><span></span>centrifugo --config=config.json --port=8002 --engine=redis --redis_host=127.0.0.1 --redis_port=6379
</pre></div>


<p>Now you have 3 Centrifugo instances running on ports 8000, 8001, 8002 and clients can connect to any of them. You can also send API requests to any of those nodes – as all nodes connected over Redis PUB/SUB message will be delivered to all interested clients on all nodes.</p>
<p>To load balance clients between nodes you can use Nginx – you can find its configuration here in documentation.</p>
<h3 id="redis-sharding">Redis sharding<a class="headerlink" href="#redis-sharding" title="Permanent link">&para;</a></h3>
<p>Centrifugo has a built-in Redis sharding support.</p>
<p>This resolves situation when Redis becoming a bottleneck on large Centrifugo setup. Redis is single-threaded server, it&rsquo;s very fast but it&rsquo;s power is not infinite so when your Redis approaches 100% CPU usage then sharding feature can help your application to scale.</p>
<p>At moment Centrifugo supports simple comma-based approach to configuring Redis shards. Let&rsquo;s just look on examples.</p>
<p>To start Centrifugo with 2 Redis shards on localhost running on port 6379 and port 6380:</p>
<div class="codehilite"><pre><span></span>centrifugo --config=config.json --engine=redis --redis_port=6379,6380
</pre></div>


<p>To start Centrifugo with Redis instances on different hosts:</p>
<div class="codehilite"><pre><span></span>centrifugo --config=config.json --engine=redis --redis_host=192.168.1.34,192.168.1.35
</pre></div>


<p>If you also need to customize AUTH password, Redis DB number then you can use <code>redis_url</code> option.</p>
<p>Note, that due to how Redis PUB/SUB work it&rsquo;s not possible (and it&rsquo;s pretty useless anyway) to run shards in one Redis instances using different Redis DB numbers.</p>
<p>When sharding enabled Centrifugo will spread channels and history/presence keys over configured Redis instances using consistent hashing algorithm. At moment we use Jump consistent hash algorithm (see <a href="https://arxiv.org/pdf/1406.2294.pdf">paper</a> and <a href="https://github.com/dgryski/go-jump">implementation</a>)</p>
<h3 id="keydb-engine">KeyDB engine<a class="headerlink" href="#keydb-engine" title="Permanent link">&para;</a></h3>
<p>Centrifugo Redis engine seamlessly works with <a href="https://keydb.dev/">KeyDB</a>. KeyDB server is compatible with Redis and provides several additional features beyond. </p>
<p>Though we can&rsquo;t give any promises about compatibility with KeyDB in future Centrifugo releases - while KeyDB is fully compatible with Redis things should work fine. That&rsquo;s why we consider this as <strong>EXPERIMENTAL</strong> feature.</p>
<p>Use KeyDB instead of Redis only if you are really sure you need it. Nothing stops you from running several Redis instances per each core you have, configure sharding and obtain even better performance that KeyDB can provide (due to lack of synchronization between threads in Redis).</p>
<p>In order to run Centrifugo with KeyDB all you need to do is use <code>redis</code> engine option and run KeyDB server instead of Redis.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../authentication/" title="Authentication" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Authentication
              </span>
            </div>
          </a>
        
        
          <a href="../admin/" title="Admin web interface" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Admin web interface
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>