



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Centrifugo Documentation">
      
      
        <link rel="canonical" href="https://github.com/centrifugal/centrifugo/server/proxy/">
      
      
        <meta name="author" content="Centrifugal">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Proxy to backend - Centrifugo Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../theme/styles/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="cyan">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#proxy-calls-to-app-backend" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://github.com/centrifugal/centrifugo" title="Centrifugo Documentation" class="md-header-nav__button md-logo">
          
            <img src="../../images/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Centrifugo Documentation
            </span>
            <span class="md-header-nav__topic">
              Proxy to backend
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/centrifugal/centrifugo/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    centrifugal/centrifugo
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://github.com/centrifugal/centrifugo" title="Centrifugo Documentation" class="md-nav__button md-logo">
      
        <img src="../../images/logo.png" width="48" height="48">
      
    </a>
    Centrifugo Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/centrifugal/centrifugo/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    centrifugal/centrifugo
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../guide/" title="Integration Guide" class="md-nav__link">
      Integration Guide
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../channels/" title="Channels" class="md-nav__link">
      Channels
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../authentication/" title="Authentication" class="md-nav__link">
      Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../engines/" title="Engines" class="md-nav__link">
      Engines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../admin/" title="Admin web interface" class="md-nav__link">
      Admin web interface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../http_api/" title="Server HTTP API" class="md-nav__link">
      Server HTTP API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../grpc_api/" title="Server GRPC API" class="md-nav__link">
      Server GRPC API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../recover/" title="Message recovery" class="md-nav__link">
      Message recovery
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../signals/" title="Signal handling" class="md-nav__link">
      Signal handling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../connection_expiration/" title="Connection expiration" class="md-nav__link">
      Connection expiration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../private_channels/" title="Private channels" class="md-nav__link">
      Private channels
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Proxy to backend
      </label>
    
    <a href="./" title="Proxy to backend" class="md-nav__link md-nav__link--active">
      Proxy to backend
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#proxy-headers" title="Proxy headers" class="md-nav__link">
    Proxy headers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connect-proxy" title="connect proxy" class="md-nav__link">
    connect proxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refresh-proxy" title="refresh proxy" class="md-nav__link">
    refresh proxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rpc-proxy" title="rpc proxy" class="md-nav__link">
    rpc proxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#return-custom-error" title="Return custom error" class="md-nav__link">
    Return custom error
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#return-custom-disconnect" title="Return custom disconnect" class="md-nav__link">
    Return custom disconnect
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../protobuf/" title="Protobuf protocol" class="md-nav__link">
      Protobuf protocol
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../protocol/" title="Client protocol" class="md-nav__link">
      Client protocol
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Transports
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Transports
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../transports/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../transports/websocket/" title="Websocket" class="md-nav__link">
      Websocket
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../transports/sockjs/" title="SockJS" class="md-nav__link">
      SockJS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Libraries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Libraries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../libraries/client/" title="Client libraries" class="md-nav__link">
      Client libraries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../libraries/api/" title="API libraries" class="md-nav__link">
      API libraries
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Deploy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Deploy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/packages/" title="RPM and DEB packages" class="md-nav__link">
      RPM and DEB packages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/docker/" title="Docker image" class="md-nav__link">
      Docker image
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/nginx/" title="Nginx configuration" class="md-nav__link">
      Nginx configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/tls/" title="TLS" class="md-nav__link">
      TLS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/redis/" title="Redis HA" class="md-nav__link">
      Redis HA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../deploy/tuning/" title="OS tuning" class="md-nav__link">
      OS tuning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Misc
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Misc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/insecure_modes/" title="Insecure modes" class="md-nav__link">
      Insecure modes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/migrate/" title="Migrate from Centrifugo v1" class="md-nav__link">
      Migrate from Centrifugo v1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/benchmark/" title="Benchmarking server" class="md-nav__link">
      Benchmarking server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#proxy-headers" title="Proxy headers" class="md-nav__link">
    Proxy headers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connect-proxy" title="connect proxy" class="md-nav__link">
    connect proxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refresh-proxy" title="refresh proxy" class="md-nav__link">
    refresh proxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rpc-proxy" title="rpc proxy" class="md-nav__link">
    rpc proxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#return-custom-error" title="Return custom error" class="md-nav__link">
    Return custom error
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#return-custom-disconnect" title="Return custom disconnect" class="md-nav__link">
    Return custom disconnect
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/centrifugal/documentation/edit/master/docs/server/proxy.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="proxy-calls-to-app-backend">Proxy calls to app backend<a class="headerlink" href="#proxy-calls-to-app-backend" title="Permanent link">&para;</a></h1>
<p>Starting from Centrifugo v2.3.0 it&rsquo;s possible to proxy some client connection events over HTTP to application backend and react to them in a way you need. For example you can authenticate connection via request from Centrifugo to your app backend, refresh client sessions and answer to RPC calls sent by client over WebSocket or SockJS connections.</p>
<h3 id="proxy-headers">Proxy headers<a class="headerlink" href="#proxy-headers" title="Permanent link">&para;</a></h3>
<p>All proxy calls are <strong>HTTP POST</strong> requests which include <code>Cookie</code>, <code>User-Agent</code>, <code>X-Real-Ip</code>, <code>X-Forwarded-For</code>, <code>X-Request-Id</code>, <code>Authorization</code> headers from original client request and include some additional info as JSON body (for example data sent by client in RPC call etc).</p>
<p>Below we will look at all supported proxy calls and what you can achieve using them.</p>
<h3 id="connect-proxy">connect proxy<a class="headerlink" href="#connect-proxy" title="Permanent link">&para;</a></h3>
<p>With the following options in configuration file:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="err">...</span>
  <span class="nt">&quot;proxy_connect_endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:3000/centrifugo/connect&quot;</span><span class="p">,</span>
  <span class="nt">&quot;proxy_connect_timeout&quot;</span><span class="p">:</span>  <span class="mi">1</span>
<span class="p">}</span>
</pre></div>


<p>– connection requests <strong>without JWT set</strong> will be proxied to <code>proxy_connect_endpoint</code> URL endpoint. On your backend side you can authenticate incoming connection and return client credentials to Centrifugo in response to proxied request.</p>
<p>This means you don&rsquo;t need to generate JWT token and pass it to client side and can rely on cookie while authenticating user. <strong>Centrifugo should work on same domain in this case so your site cookie could be passed to Centrifugo</strong>. This also means that <strong>every</strong> new connection from user will result in HTTP POST request to your application backend. While with JWT token you usually generate it once on application page reload, if client reconnects due to Centrifugo restart or internet connection loss it uses the same JWT it had before thus usually no additional requests generated during reconnect process (until JWT expired).</p>
<p>Payload example that will be sent to app backend when client without token wants to establish connection with Centrifugo and <code>proxy_connect_endpoint</code> is set to non-empty URL string:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;client&quot;</span><span class="p">:</span><span class="s2">&quot;9336a229-2400-4ebc-8c50-0a643d22e8a0&quot;</span><span class="p">,</span>
  <span class="nt">&quot;transport&quot;</span><span class="p">:</span><span class="s2">&quot;websocket&quot;</span><span class="p">,</span>
  <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
  <span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="s2">&quot;json&quot;</span>
<span class="p">}</span>
</pre></div>


<p>Request fields:</p>
<ul>
<li><code>client</code> is a unique client ID generated by Centrifugo for each incoming connection</li>
<li><code>transport</code> is transport name (<code>websocket</code> or <code>sockjs</code> at moment)</li>
<li><code>protocol</code> is a protocol type used by client (<code>json</code> or <code>protobuf</code> at moment)</li>
<li><code>encoding</code> is a protocol encoding type used (<code>json</code> or <code>binary</code> at moment)</li>
</ul>
<p>Response expected:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span><span class="nt">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;56&quot;</span><span class="p">}}</span>
</pre></div>


<p>Result fields you can set:</p>
<ul>
<li><code>user</code> (string) is user ID (calculated on app backend based on request cookie header for example). Return it as empty string for accepting unauthenticated request</li>
<li><code>expire_at</code> (optional integer) is a timestamp when connection must be considered expired. If not set or set to <code>0</code> connection won&rsquo;t expire at all</li>
<li><code>info</code> (optional JSON) is a connection info JSON</li>
<li><code>b64info</code> (optional string) is a binary connection info encoded in base64 format</li>
</ul>
<p><code>proxy_connect_timeout</code> (float, in seconds) controls timeout of HTTP POST request sent to app backend.</p>
<h3 id="refresh-proxy">refresh proxy<a class="headerlink" href="#refresh-proxy" title="Permanent link">&para;</a></h3>
<p>With the following options in configuration file:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="err">...</span>
  <span class="nt">&quot;proxy_refresh_endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:3000/centrifugo/refresh&quot;</span><span class="p">,</span>
  <span class="nt">&quot;proxy_refresh_timeout&quot;</span><span class="p">:</span>  <span class="mi">1</span>
<span class="p">}</span>
</pre></div>


<p>– Centrifugo will call <code>proxy_refresh_endpoint</code> when it&rsquo;s time to refresh connection. Centrifugo itself will ask your backend about connection validity instead of refresh workflow on client side.</p>
<p>Payload sent to app backend in refresh request (when connection is going to expire):</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;client&quot;</span><span class="p">:</span><span class="s2">&quot;9336a229-2400-4ebc-8c50-0a643d22e8a0&quot;</span><span class="p">,</span>
  <span class="nt">&quot;transport&quot;</span><span class="p">:</span><span class="s2">&quot;websocket&quot;</span><span class="p">,</span>
  <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
  <span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
  <span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="s2">&quot;56&quot;</span>
<span class="p">}</span>
</pre></div>


<p>Request fields:</p>
<ul>
<li><code>client</code>, <code>transport</code>, <code>protocol</code>, <code>encoding</code> are the same as described for connect request payload</li>
<li><code>user</code> is a connection user ID obtained during authentication process</li>
</ul>
<p>Response expected:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span><span class="nt">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;exp&quot;</span><span class="p">:</span> <span class="mi">1565436268</span><span class="p">}}</span>
</pre></div>


<p>Result fields:</p>
<p><code>expired</code> (boolean) is a flag to mark connection as expired - client will be diconnected
<code>expire_at</code> (integer) is a next timestamp when connection must be considered expired
<code>info</code> (optional JSON) is a connection info JSON
<code>b64info</code> (optional string) is a binary connection info encoded in base64 format</p>
<p><code>proxy_refresh_timeout</code> (float, in seconds) controls timeout of HTTP POST request sent to app backend.</p>
<h3 id="rpc-proxy">rpc proxy<a class="headerlink" href="#rpc-proxy" title="Permanent link">&para;</a></h3>
<p>With the following option in configuration file:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="err">...</span>
  <span class="nt">&quot;proxy_rpc_endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:3000/centrifugo/connect&quot;</span><span class="p">,</span>
  <span class="nt">&quot;proxy_rpc_timeout&quot;</span><span class="p">:</span>  <span class="mi">1</span>
<span class="p">}</span>
</pre></div>


<p>RPC calls over client connection will be proxied to <code>proxy_rpc_endpoint</code>. This allows developer to utilize WebSocket (or SockJS) connection in bidirectional way.</p>
<p>Payload sent to app backend in RPC request:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;client&quot;</span><span class="p">:</span><span class="s2">&quot;9336a229-2400-4ebc-8c50-0a643d22e8a0&quot;</span><span class="p">,</span>
  <span class="nt">&quot;transport&quot;</span><span class="p">:</span><span class="s2">&quot;websocket&quot;</span><span class="p">,</span>
  <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
  <span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
  <span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="s2">&quot;56&quot;</span><span class="p">,</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:{</span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="s2">&quot;getCurrentYear&quot;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Request fields:</p>
<ul>
<li><code>client</code>, <code>transport</code>, <code>protocol</code>, <code>encoding</code> are the same as described for connect request payload</li>
<li><code>user</code> is a connection user ID obtained during authentication process</li>
<li><code>data</code> is an RPC data sent by client</li>
<li><code>b64data</code> will be set instead of <code>data</code> field for connections that use binary payload encoding</li>
</ul>
<p>Response expected:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span><span class="nt">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;answer&quot;</span><span class="p">:</span> <span class="s2">&quot;2019&quot;</span><span class="p">}}}</span>
</pre></div>


<p>Result fields:</p>
<p><code>data</code> (JSON) is and RPC response - any valid JSON is supported
<code>b64data</code> string can be set instead of <code>data</code> for binary response encoded in base64 format</p>
<h3 id="return-custom-error">Return custom error<a class="headerlink" href="#return-custom-error" title="Permanent link">&para;</a></h3>
<p>Application backend can return JSON object that contain an error to return it to client:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;error&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;custom error&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Application can use error codes &gt;= 1000, error codes in range 0-999 are reserved by Centrifugo internal protocol.</p>
<p>This <strong>does not apply to response on refresh request</strong> as there is no sense in returning an error (will not reach client anyway). </p>
<p><code>proxy_rpc_timeout</code> (float, in seconds) controls timeout of HTTP POST request sent to app backend.</p>
<h3 id="return-custom-disconnect">Return custom disconnect<a class="headerlink" href="#return-custom-disconnect" title="Permanent link">&para;</a></h3>
<p>Application backend can return JSON object that contain an custom disconnect object to disconnect client in custom way:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;disconnect&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="mi">4000</span><span class="p">,</span>
    <span class="nt">&quot;reconnect&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;custom disconnect&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Application can use numbers in range 4000-4999 for custom disconnect codes. Numbers below 4000 are reserved by Centrifugo internal protocol. Keep in mind that <strong>due to WebSocket protocol limitations and Centrifugo internal protocol needs you need to keep disconnect reason string no longer than 32 symbols</strong>.</p>
<p>This <strong>does not apply to response on refresh request</strong> as there is no way to control disconnect at moment - client will always be disconnected with <code>expired</code> disconnect reason.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../private_channels/" title="Private channels" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Private channels
              </span>
            </div>
          </a>
        
        
          <a href="../protobuf/" title="Protobuf protocol" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Protobuf protocol
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>